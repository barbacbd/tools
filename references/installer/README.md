# Table of Contents

- [gcp](./gcp) - Directory containing information for installer gp clusters.
- [scripts](./scripts) - Directory containing general installer scripts.
- [secrets](./secrets) - Directory containing information relavant to obtaining and using pull secrets for the installer.
- [upi](./upi) - Directoru containing information for installer UPI clusters.
- This directory contains the information and scripts to generate a docker/podman image for the installer.

# Instructions and Notes for Creating a cluster with Openshift Installer

This document will include the information for utilizing openshift-installer to create a cluster. This tool
is used to create a Docker image and create/install a cluster using openshift-installer.

# Related Projects

See the following Projects for references that will be mentioned throughout this document:

- [Pull Secrets](https://github.com/barbacbd/tools/blob/main/references/PullSecret.md)
- [Openshift Installer](https://github.com/openshift/installer)

# Creating a cluster

To reate a cluster using openshift-installer run the following command:

```bash
cd /path/to/installer/;

hack/build.sh;

bin/openshift-installer create cluster

```

This process will start by asking for some information that will be generated in the `install-config.yaml`.
Then the process of installing will begin.

# Accessing the cluster

The end of the installation will provide information about entering the cluster:

```
INFO Login to the console with user: "{{ kube_username }}", and password: "{{ password }}"
```

Before entering the cluster, the `oc` executable must be installed:

```bash

wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-client-linux.tar.gz

tar -xvzf openshift-client-linux.tar.gz
```

This will produce the `oc` executable (as well as another). Move the executable(s) to `/usr/bin` or `/usr/local/bin` so they are in `$PATH`.

# Installer Container Documentation

The script `generate.py` will generate the necessary file for creating a docker image.

The following is the output when the command in line 1 is executed.

```
[$USER@$USER installer]$ python3 generate.py 
Removing all data from openshift-installer-data
Execute the following command:

cd openshift-installer-data && podman build . -t <image_name>:<image_tag>
```

The output files will reside in `./openshift-installer-data`. The user can copy and paste
the final line of the output to create the image.

The following should provide a look at your new image.

```bash
podman image ls
```

To enter the image go to `openshift-installer-data` and execute `connect.sh`.

After connecting to the container, any extra setup including special environment configurations
will be generated by executing the `configure.sh` script found in `/`.

To run the installer with the auto generated config, execute the script `install.sh` from
a running container. The file resides in `/`.

# YAML Configuration

The following parameters are required in the yaml file as inputs to the install-config template:
- platform - cloud platform
- region - region for the platform (these may be similar between platforms, but are specific)
- base_domain - domain for the cluster
- secrets_file - File where the secrets information is stored, please [read](https://github.com/barbacbd/tools/blob/main/references/PullSecret.md) for more information.
- ssh_key_file - File where the ssh key is stored (usually in ~/.ssh)

The following parameters are required for the rest of the configuration process:
- docker
  - image_name: name of the local image when using `podman image ls`
  - iamge_tag: tag for the image (usually `latest`)

The following are optional parameters for the configuration process:
- env - Any parameters added here are in the (key,value) pair format formatted in the file like:
```
env:
  key: value
```
The following is the same as `export key=value`


# Supported Platforms

- aws
- gcp


# OC References

Downloads can be found [here](https://amd64.ocp.releases.ci.openshift.org/).


# Extra installation notes

When installing a cluster from the latest `master/main` branch, export an environment variable to override the release image.

```bash
export OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE={ release-image }
openshift-install create cluster
```

The release-image can be found [here](https://amd64.ocp.releases.ci.openshift.org/). Look at the top of the web page for the image name.
Generally the line will include `oc adm release extract`, but you only need the image link at the tail end of the line.
